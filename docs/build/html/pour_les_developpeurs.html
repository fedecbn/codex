

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pour les développeurs &mdash; documentation Codex 0.0.1</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="documentation Codex 0.0.1" href="index.html"/>
        <link rel="next" title="Bugs connus" href="bugs_connus.html"/>
        <link rel="prev" title="Pour les administrateurs" href="pour_les_administrateurs.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Codex
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pour_les_utilisateurs.html">Pour les utilisateurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pour_les_administrateurs.html">Pour les administrateurs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pour les développeurs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#architecture-fichier-du-codex">Architecture fichier du Codex</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture-base-de-donnees-du-codex">Architecture Base de données du Codex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#le-schema-application">Le schema application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-schemas-rubrique">Les schemas &#8220;rubrique&#8221;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#le-schema-referentiel">Le schema référentiel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comment-creer-une-nouvelle-rubrique">Comment créer une nouvelle rubrique?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gestion-des-droits">Gestion des droits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#les-niveaux-de-droits">Les niveaux de droits</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-roles">Les rôles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#definir-les-droits">Définir les droits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comment-parametrer-les-tableaux-de-synthese">Comment paramétrer les tableaux de synthèse?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comment-gerer-les-fiches">Comment gérer les fiches?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comment-ajouter-de-nouveaux-onglets">Comment ajouter de nouveaux onglets?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bugs_connus.html">Bugs connus</a></li>
<li class="toctree-l1"><a class="reference internal" href="developpement_prevues.html">Développement à prévoirs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Codex</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Pour les développeurs</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/pour_les_developpeurs.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pour-les-developpeurs">
<h1>Pour les développeurs<a class="headerlink" href="#pour-les-developpeurs" title="Lien permanent vers ce titre">¶</a></h1>
<p>Bienvenue sur le Wiki du Codex pour les développeurs</p>
<div class="section" id="architecture-fichier-du-codex">
<h2>Architecture fichier du Codex<a class="headerlink" href="#architecture-fichier-du-codex" title="Lien permanent vers ce titre">¶</a></h2>
<p>Voici la description du contenu de chaque dossier :</p>
<blockquote>
<div><cite>.git</cite></div></blockquote>
<p>dossier git permettant le versionnement de l&#8217;application</p>
<blockquote>
<div><cite>_DATA</cite></div></blockquote>
<p>contient les données à importer ou les données exportées (dossier EXPORTS). Aujourd&#8217;hui, les autres dossiers (alp, als, bal...) sont/peuvent être utilisés par la rubrique &#8220;Interaction avec le hub&#8221;. Leur création n&#8217;est pas automatique (fonction à ajouter lors de la création d&#8217;une nouvelle ligne dans cette rubrique).</p>
<blockquote>
<div><cite>_GRAPH</cite></div></blockquote>
<p>contient toutes les images utilisées par le codex.</p>
<blockquote>
<div><cite>_INCLUDE</cite></div></blockquote>
<p>contient toutes les librairies/éléments nécessaires au fonctionnement du codex</p>
<ul>
<li><p class="first">css : tous les CSS (NB : toute la configuration du css est majoritairement géré par eval.css)</p>
</li>
<li><p class="first">font : tous les éléments de polices</p>
</li>
<li><p class="first">js : tous les javascripts externes (jquery,datatable,wysiwyg...) et les javascripts maison.</p>
<blockquote>
<div><ul class="simple">
<li>gestion.js : (obsolète) ancien fichier javascript qui rassemblait tous les fichier suivant</li>
<li>fiche.js : boutons et interactions avec les fiches (génériques aux rubriques)</li>
<li>functions.js : fonctions génériques javascripts (export, suppression, validation...)</li>
<li>interact.js : boutons et interactions avec les tableaux de synthèse (génériques aux rubriques)</li>
<li>liste.js : interaction avec la liste</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">admin.lang.php : Gestion de la traduction anglais / français ($lang)</p>
</li>
<li><p class="first">common.lang.php : Définition des variables de label + italien ($lang)</p>
</li>
<li><p class="first">config_sql.inc.php : Paramètre de connexion aux bases de données + data path</p>
</li>
<li><p class="first">connector.php : Controleur d&#8217;accès</p>
</li>
<li><p class="first">constants.inc.php : Gestion des constantes</p>
</li>
<li><p class="first">fonctions.inc.php : Fonctions php utilisées par le Codex.</p>
<blockquote>
<div><p><cite>_SQL</cite></p>
</div></blockquote>
</li>
</ul>
<p>fichiers SQL d&#8217;installation + fichier de mise à jour de la base avec les nouvelles versions de l&#8217;outil (update_bdd)</p>
<blockquote>
<div><cite>docs</cite></div></blockquote>
<p>source et build de la documentation (produite avec Sphinx)</p>
<blockquote>
<div><cite>flore</cite></div></blockquote>
<p>rubriques du codex. Les rubriques catnat, eee, fsd, hub, lr,lsi, refnat, syntaxa sont des rubriques thématiques. Elles ont été généralisé mais ne sont pas toutes au même niveau de généralisation. la rubrique bug est obsolète (pas maintenu), la rubrique commun est peu utilisée (devrait être ajouté à _INCLUDE), la rubrique default est une rubrique type,la rubrique module-admin est spécial (non généralisé). Les rubriques génériques comprennent :</p>
<blockquote>
<div><ul>
<li><p class="first">commun.inc.php :</p>
<blockquote>
<div><ul class="simple">
<li>initialise et fait le lien avec toutes les bibliothèques nécessaire (_INCLUDE)</li>
<li>définit un certain nombre de constantes</li>
<li>détermine les requêtes SQL globales (requête du tableau de synthèse, requête d&#8217;export, requête de discussion...)</li>
<li>label spécifiques (boutons ajouter, titres...)</li>
<li>construction des en-tête de colonne</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">del.php : utilisé lors de suppression</p>
</li>
<li><p class="first">index.php : interface principale</p>
</li>
<li><p class="first">liste.php (et parfois liste_user) = json avec toutes les données du tableau de synthèse</p>
</li>
<li><p class="first">submit.php : utilisé lors de l&#8217;enregistrement</p>
<blockquote>
<div><p><cite>les autres fichiers</cite></p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>.gitignore: les éléments à ne pas sauvegarder lors du versionnement</li>
<li>README.md : description de l&#8217;application.</li>
</ul>
</div>
<div class="section" id="architecture-base-de-donnees-du-codex">
<h2>Architecture Base de données du Codex<a class="headerlink" href="#architecture-base-de-donnees-du-codex" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="le-schema-application">
<h3>Le schema application<a class="headerlink" href="#le-schema-application" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le schema application est le schema utilisé par l&#8217;application pour faire la gestion des rubriques, des onglets, des utlisateurs des droits...</p>
<blockquote>
<div><cite>bug</cite></div></blockquote>
<p>(obsolète) table rassemblant tous les bugs remontés par les utilisateurs.</p>
<blockquote>
<div><cite>droit</cite></div></blockquote>
<p>La gestion des droits est basé sur un système non hierarchisé. Le principe      de base</p>
<blockquote>
<div><p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
<p><cite>xxx</cite></p>
</div></blockquote>
</div>
<div class="section" id="les-schemas-rubrique">
<h3>Les schemas &#8220;rubrique&#8221;<a class="headerlink" href="#les-schemas-rubrique" title="Lien permanent vers ce titre">¶</a></h3>
</div>
<div class="section" id="le-schema-referentiel">
<h3>Le schema référentiel<a class="headerlink" href="#le-schema-referentiel" title="Lien permanent vers ce titre">¶</a></h3>
</div>
</div>
<div class="section" id="comment-creer-une-nouvelle-rubrique">
<h2>Comment créer une nouvelle rubrique?<a class="headerlink" href="#comment-creer-une-nouvelle-rubrique" title="Lien permanent vers ce titre">¶</a></h2>
<p>Aujourd&#8217;hui, le processus de création de rubrique est encore manuel.
Une des améliorations possible serait que l&#8217;administration des rubriques soient directement intérefacées dans le codex (dans la partie administration).</p>
<p>Actuellement, pour créer une nouvelle rubrique il faut :</p>
<ul class="simple">
<li>lancez les scripts sql du fichier _DATA/fonctions.sql. Ce script créé plusieurs fonction pl/pgsql pour créer des rubriques.</li>
<li>utilisez la fonction new_rubrique en choisissant le nom de la rubrique que vous souhaitez créer (ex : SELECT * FROM new_rubrique(&#8216;toto&#8217;); ==&gt; un nouveau schema &#8216;toto&#8217; est créé)</li>
<li>dupliquez le dossier &#8220;defaut&#8221; et renommez-le avec le nom du schéma créé ce dessus (ex : &#8216;toto&#8217;). ATTENTION : le nom doit être exactement identique.</li>
</ul>
</div>
<div class="section" id="gestion-des-droits">
<h2>Gestion des droits<a class="headerlink" href="#gestion-des-droits" title="Lien permanent vers ce titre">¶</a></h2>
<p>La gestion des droits est basée sur un système non hierarchisé de rôle pour chaque utilisateur. Chaque rôle a droit ou non d&#8217;accéder à des objets dans une rubrique. Ces droits sont classé par type de droit, appelé également niveaux de droits (droit d&#8217;accès à une page, droit d&#8217;accès à un bouton...).</p>
<div class="section" id="les-niveaux-de-droits">
<h3>Les niveaux de droits<a class="headerlink" href="#les-niveaux-de-droits" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les niveaux de droits, ou type de droit, sont une manière de faciliter la gestion globale des droits. On distingue les niveaux suivant  :</p>
<ul class="simple">
<li><strong>d1</strong> : droit d&#8217;accès aux fichiers. Ce type de droit permet de définir quel role peut accéder à quel fichier fichier. Dans ce cas, l&#8217;objet est le fichier,</li>
<li><strong>d2</strong> : droit d&#8217;accès aux objets de la rubrique. Ce type de droit permet de définir quel rôle peut accéder à quel objet d&#8217;une rubrique. Dans ce cas, l&#8217;objet peut être un bouton, une image...,</li>
<li><strong>d3</strong> : droit d&#8217;accès spécifique à l&#8217;utilisateur. Ce type de droit permet de définir, en fonction de l&#8217;utilisateur, quel accès il possède (ex : dans la partie &#8220;administration &gt; utilisateurs&#8221;, un CBN ne peut voir que les utilisateurs de son CBN),</li>
<li><strong>d4</strong> : droit d&#8217;accès à une champ. Ce type de droit permet de définir quel rôle peut, dans une fiche, modifier un champ. Dans le cas contraire, le champ sera bloqué,</li>
<li><strong>d5</strong> : droit de modification de la base. Ce type de droit permet de définir sur quel rôle a le droit de modifier la base de données (ajout, modification, suppression).</li>
</ul>
<p>A ce jour, seulement les niveaux de droit d1 et d2 ont été mis en place.</p>
</div>
<div class="section" id="les-roles">
<h3>Les rôles<a class="headerlink" href="#les-roles" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour chaque rubrique, l&#8217;utilisateur possède un ou plusieurs rôles. Le rôle par défaut d&#8217;un utilsateur à sa création est &#8220;pas d&#8217;accès&#8221; (en base de donnéées, &#8220;pas d&#8217;accès&#8221; = TRUE). Un utilisateur qui a accès à une rubrique a au moins un rôle activé (en base de données &#8220;<cite>nom_du_role</cite> = TRUE&#8221;) ET la colonne &#8220;pas d&#8217;acces&#8221; = FALSE. La gestion des rôle pour chaque utilisateur est géré, dans la base de données, dans la table <strong>utilisateur_role</strong>.</p>
</div>
<div class="section" id="definir-les-droits">
<h3>Définir les droits<a class="headerlink" href="#definir-les-droits" title="Lien permanent vers ce titre">¶</a></h3>
<p>Au sein de la base de données, la table <strong>droit</strong> fait le lien entre les rôles et les niveaux de droit. Ainsi, il est possible de définir dans cette table quel rôle a accès à quel droit sur tel objet d&#8217;une rubrique. Aujourd&#8217;hui, la gestion de la définition des droits n&#8217;a pas été interfacé avec le codex (gestion direct en base de données).</p>
<ul class="simple">
<li>Ajouter une règle d&#8217;accès</li>
</ul>
<p>La première étape lors pour définir les droits est de se poser la question de &#8220;quel rôle aura le droit de réaliser cette action?&#8221;. En répondant à cette question, il est alors possible de rajouter une ligne dans la table droit qui correspond à la réponse à cette question. Ensuite, il est possible d&#8217;accèder à cette nouvelle règle en utilisant dans le code à la fonction <strong>ref_droit</strong>.</p>
<ul class="simple">
<li>Ajouter des rôles</li>
</ul>
<p>La gestion des droits n&#8217;étant pas hierarchisée, il est possible d&#8217;ajouter des rôles en fonction du besoin dans le cas où les rôles existants ne suffisent pas. Ex : ajout du rôle de validateur. Pour se faire, il est nécessaire d&#8217;ajouter une colonne à la table <strong>utilisateur_role</strong> et d&#8217;attribuer le rôle correspondant aux utilisateurs. Les règles correspondantes à ce nouveau rôle devront être décrit dans la table <strong>droit</strong></p>
</div>
</div>
<div class="section" id="comment-parametrer-les-tableaux-de-synthese">
<h2>Comment paramétrer les tableaux de synthèse?<a class="headerlink" href="#comment-parametrer-les-tableaux-de-synthese" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="comment-gerer-les-fiches">
<h2>Comment gérer les fiches?<a class="headerlink" href="#comment-gerer-les-fiches" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="comment-ajouter-de-nouveaux-onglets">
<h2>Comment ajouter de nouveaux onglets?<a class="headerlink" href="#comment-ajouter-de-nouveaux-onglets" title="Lien permanent vers ce titre">¶</a></h2>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bugs_connus.html" class="btn btn-neutral float-right" title="Bugs connus" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pour_les_administrateurs.html" class="btn btn-neutral" title="Pour les administrateurs" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Thomas Milon.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>